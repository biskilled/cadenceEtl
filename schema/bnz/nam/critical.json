[
  {"target": ["sql", "STG_NFAL"],
   "query": ["oracle",
    ["SELECT FALNR AS CaseNum, FALAR AS CaseType, PATNR AS PatNum, BEKAT AS TreatCat, ABRKZ AS BillFlg, EINZG AS GeoCode, STATU AS CaseStat, NOTAN AS ErAdmFlg, ",
     "ERDAT AS CreationDate,UPDAT AS UpdateDate, STORN AS CancelFlg, STDAT AS CancelDate, RESID AS ResidFlg, FOREI AS AgrmNum2, EMTYP AS EmployeeType, ",
     "ZZDCLASSZZ AS HospKeren, ZZAGRMNT_NUMZZ AS AgrmNum, ZZCOMMENT AS comment, GSTA1 AS BirthWeek FROM SAPR3.NFAL ",
      "WHERE einri = '0001' AND erdat between '$start' and '$end' ",
      "And STORN != 'X'"]
     ],
    "merge":["DWH_NFAL",["CaseNum"]],
    "sttappend":{
      "CreationDate":{"s":"ERDAT","t":"varchar(10)","f":"fDCast()"},
      "UpdateDate":  {"s":"UPDAT","t":"varchar(10)","f":"fDCast()"},
      "CancelDate":  {"s":"STDAT","t":"varchar(10)","f":"fDCast()"},
      "ETL_Date":      {"t":"date","f":"fDCurr()"}
    }
  },
  {
    "target": ["sql", "STG_NPAT"],
    "query": ["oracle",
      [
        "SELECT  PATNR AS PatNum, GSCHL AS SexCode, NNAME AS LastName, VNAME AS FirstName, GBDAT AS BirthDate, GLAND AS BirthCountry, ",
        "TODKZ AS DeathFlg , TODDT AS DeathDate, TODZT AS DeathTime, FAMST AS FamilyStat, KONFE AS PatReligion, NATIO AS PatNation, ",
        "PSTLZ AS PatZipCode, ORT AS PatCityName, STRAS AS PatAddress, GEBIE AS PatCityCode, TELF1 AS PatTelNum, EXTNR AS PatIdNum, ",
        "ERDAT AS CreationDate, UPDAT AS UpdateDate,STORN AS CancelFlg ,STDAT AS CancelDate,PASSTY AS IdDocType, PASSNR AS IdDocNum , ",
        "ADRNR AS AddrCodeNum ,ADROB AS AddressObjNum ,ZNIMG_DZZ AS AliaDate, ZNCHILDNOZZ AS ChildrenNum,ZNKUPA_NOZZ AS KupaCode, ZNE_LNAMEZZ AS LastNameEng, ZNE_FNAMEZZ AS FirstNameEng, ",
        "GBNAM AS GBNAM, ZNM_NAMEZZ AS ZNM_NAMEZZ, ANVN1 AS ANVN1, ANNA1 AS ANNA1, ANVN2 AS ANVN2, AGTEL AS AGTEL, ANNA2 AS ANNA2, ANTE1 AS ANTE1 ",
        "FROM SAPR3.NPAT WHERE MANDT=938 AND EINRI='0001'"
      ]
    ],
    "sttappend":{
      "UpdateDate": {"s":"UPDAT","t":"varchar(10)","f":"fDCast()"},
      "DeathDate":  {"s":"TODDT","t":"date","f":"fDCast()"},
      "DeathTime":  {"s":"TODZT","t":"varchar(10)","f":"fTCast()"},
      "CreationDate": {"s":"ERDAT","t":"varchar(10)","f":"fDCast()"},
      "CancelDate": {"s":"STDAT","t":"varchar(10)","f":"fDCast()"},
      "AliaDate":   {"s":"ZNIMG_DZZ","t":"varchar(10)","f":"fDCast()"},
      "BirthDate":  {"s":"GBDAT","t":"varchar(10)","f":"fDCast()"},
      "PatIdNum":     {"s":"EXTNR","f":"fR('-','')"},
      "ETL_Date":     {"t":"date","f":"fDCurr()"}
    }
  },

{"target": ["sql", "STG_NBEW"],
    "query": ["oracle",
    ["SELECT FALNR as CaseNum, LFDNR as MvSqNum, BEWTY as MvCat, BWART as MvType, BWIDT as MvBgDate,BWIZT as MvBgTime, BWEDT as MvEndDate, BWEZT as MvEndTime,",
     "LFDREF as MvCnsqNum,NOTKZ as EmergFlg, UNFKZ as AccidentType, UNFNR as AccidentNum, UNFDT as AccidentDate,ORGFA as OrgMed, ORGPF as OrgNurs, ",
      "ZIMMR as RoomCode, BETT as BedCode, ORGAU as Gate,EZUST as DischType, ABWGN as AbsenceFlg, ERDAT as CreationDate, ERUSR as CreationUser, ",
      "UPDAT as UpdateDate, UPUSR as UpdateUser, STORN as CancelFlg, STUSR as CancelUser,STDAT as DTCancelDate, BWGR1 as MvReasFirstSec, CLASS as MevType, ",
      "RFSRC as GoremMafne, EXTKH as RefHosp, PLANB AS PLANB, BWPDT AS BWPDT, KZTXT AS KZTXT, BWPZT AS DecisionTime  ",
      "FROM SAPR3.NBEW where einri = '0001' ",
      "AND STORN != 'X' AND ",
      "(erdat between '$start' and '$end' OR updat between '$start' and '$end' OR stdat between '$start' and '$end') "]
      ],
    "sttappend":{
      "MvBgDate":     {"s":"BWIDT","t":"date","f":"fDCast()"},
      "MvEndDate":    {"s":"BWEDT","t":"date","f":"fDCast()"},
      "CreationDate": {"s":"ERDAT","t":"date","f":"fDCast()"},
      "UpdateDate":   {"s":"UPDAT","t":"date","f":"fDCast()"},
      "MvBgTime":     {"s":"BWIZT","t":"varchar(10)","f":"fTCast()"},
      "MvEndTime":    {"s":"BWEZT","t":"varchar(10)","f":"fTCast()"},
      "AccidentDate": {"s":"UNFDT","t":"date","f":"fDCast()"},
      "CancelDate":   {"s":"STDAT","t":"varchar(10)","f":"fDCast()"},
      "RoomCode": {"s":"ZIMMR","f":"fNull('-1')"},
      "BedCode":  {"s":"BETT","f":"fNull('-1')"},
      "KZTXT":    {"s":"KZTXT","t":"date","f":"fDCast()"},
      "DecisionTime":    {"s":"BWPZT","t":"varchar(10)","f":"fTCast()"},
      "ETL_Date": {"t":"date","f":"fDCurr()"},
      "MvBgDtTm":{"t":"datetime"},
      "MvEndDtTm":{"t":"datetime"},
      "NextOrgMed":{"t":"nvarchar(20)"},
      "NextOrgNurs":{"t":"nvarchar(20)"},
      "PrevOrgMed":{"t":"nvarchar(20)"},
      "PrevOrgNurs":{"t":"nvarchar(20)"},
      "SugKnisaOrgMedFlg":{"t":"smallint"},
      "SugKnisaOrgNursFlg":{"t":"smallint"},
      "SugShihrurOrgMedFlg":{"t":"smallint"},
      "SugShihrurOrgNursFlg":{"t":"smallint"},
      "EnterDate":{"t":"datetime"},
      "ExitDate":{"t":"datetime"},
      "Gate_int":{"t":"int"},
      "MedOrgTree":{"t":"int","f":"fNull('-999')"},
      "NursOrgTree":{"t":"int"},
      "mah_em_med":{"t":"int"},
      "mah_em_nurs":{"t":"int"},
      "BirthDate":{"t":"datetime"},
      "PreviousMDeptMedtree":{"t":"int"},
      "NextMDeptMedtree":{"t":"int"},
      "PreviousMDeptNurstree":{"t":"int"},
      "NextMDeptNurstree":{"t":"int"},
      "EnterMdeptNursFlg":{"t":"smallint"},
      "ExitMdeptNursFlg":{"t":"smallint"},
      "EnterMdeptMedFlg":{"t":"smallint"},
      "ExitMdeptMedFlg":{"t":"smallint"},
      "RefHosp":{"t":"varchar(10)"},
      "ExitDate_Test":{"t":"datetime"}
      }
  },
  {"target": ["sql", "STG_VBRK"],
    "query": ["oracle",
    ["SELECT VBELN as BillDocNum, FKART as BillingType, FKTYP as BillingCat,VBTYP as SDDocCat, KNUMV as CondDocNum, FKDAT as BillRepDate,",
      "BELNR as AccDocNum, GJAHR as FiscalYear, RFBSK as StatusAcc,NETWR as FLBillValueAfterGroupDisc, ERDAT as CreationDate,",
      "KUNRG as Payer, AEDAT as UpdateDate,SFAKN as CancelBillDocNum, SPART as Division,  XBLNR as ServSqNum, ZUONR as AssignNum, KIDNO as PaymRef,",
      "ISHFALAR as CaseType, ISHFALNR as CaseNum, ISHKOSTR as DEFInsurProv, ISHKTART as DEFInsurProvType, ISHABART as BillType, ISHLFDVV as SeqNumInsRel,",
      "ISHSAMNR as CollectInvNum, ISHRESID as ResFlg,ISHEMTYP as EmplType, ISHLFDBEW as MvSqNum,ISHUSERF0 as Dispute, ISHBLDAT as FinAccDate,",
      "ISHBUDAT as DocPostDate, ISHSTOID as CancelReason,ZZCLASS as HospKerenInd, ZZDRG as DRGind, ZZBWART as MvType,",
      "ZZPATCLASS as PatClass, ZZVERNR as HithaivutNum, ZZUNFNR as IruaNum,ZZ_CRDT_DAT as DTCreditDate, ERNAM as CreationUser ",
      "FROM  SAPR3.VBRK WHERE erdat between '$start' AND '$end' "]
      ],
    "sttappend":{
      "BillRepDate":     {"s":"FKDAT","t":"varchar(10)","f":"fDCast()"},
      "CreationDate": {"s":"ERDAT","t":"varchar(10)","f":"fDCast()"},
      "UpdateDate":   {"s":"AEDAT","t":"varchar(10)","f":"fDCast()"},
      "FinAccDate":    {"s":"ISHBLDAT","t":"varchar(10)","f":"fDCast()"},
      "DocPostDate": {"s":"ISHBUDAT","t":"varchar(10)","f":"fDCast()"},
      "CreditDate":   {"s":"ZZ_CRDT_DAT","t":"varchar(10)","f":"fDCast()"},
      "DEFInsurProv": {"s":"ISHKOSTR","f":"fNull('99')"},
      "DEFInsurProvType":  {"s":"ISHKTART","f":"fNull('99')"},
	  "CBNCancelled": {"t":"varchar(2)"},
	  "CBNmistake": {"t":"varchar(2)"},
      "ETL_Date": {"t":"date","f":"fDCurr()"},
      "FiscalYear":{"t":"int"},
      "MvSqNum":{"t":"int"},
      "SeqNumInsRel":{"t":"int"}
    }
  },
  {"target": ["sql", "STG_CBN_MISTAKED"],
    "query": ["oracle", "SELECT ERNAM AS CreationUser, ERDAT As CreationDate from SAPR3.ZCBN_MISTAKE"],
    "sttappend":{
      "CreationDate":     {"s":"ERDAT","t":"varchar(10)","f":"fDCast()"},
      "ETL_Date": {"t":"date","f":"fDCurr()"}
    }
  },
  {"target": ["sql", "STG_CBN_CANCELED"],
    "query": ["oracle", "select ISHSAMNR AS CBNum from SAPR3.ZNPA_EXCLUDE_CBN"],
    "sttappend": {
      "ETL_Date": {"t":"date","f":"fDCurr()"}
    }
  },
  {"target": ["sql", "STG_VBRP"],
    "query": ["oracle",
      ["SELECT VBELN AS BillDocNum, POSNR AS BillitemNum, FKIMG AS Quantity, PRSDT AS PricingDate,FBUDA AS SrvExecDate, NETWR AS PriceAfterGroupDisc, VGBEL AS Srvsqnum,",
        "VGPOS AS RefitemNum,  AUBEL AS SalesDocNum,  AUPOS AS SalesItemNum, ARKTX AS SrvDescription, PSTYV AS SalesDocItemCat, PRSFD AS Pricing,",
        "SKTOF AS CashDiscFlg, ERDAT AS CreationDate, KZWI1 AS PriceSikum1,KZWI2 AS PriceAfter4Perc, KZWI3 AS PriceSikum3, ISHBELNRF AS DocNum,",
		"ISHPOSNRF AS ItemNum, ISHBEGDT AS SrvBgDate, ISHENDDT AS SrvEndDate, ISHDATZW AS IntBilDate, ISHABLST AS SrvCode, ISHORGID AS UNBillOrgUnit, ISHABART AS BillType, ISHGPRS AS BasicPriceSrv,",
        "ISHBWART AS MvType, ISHANFOE AS OrgMedUnit, ISHANPOE AS OrgNursUnit, ISHTAGRU AS SrvCateg, ISHCLASS AS PatClass, ISHABTYP AS BillingCateg, ISHBEGZT AS SrvBgTime, ISHENDZT AS SrvEndTime,",
        "ISHUSER0 AS AgrNum, ISHUSER1 AS SCSrv, ISHLFDBEW AS MvSqNum, ISHTARAS AS MultFactor, ISHUSERDATE1 AS StartDate, ISHUSERDATE2 AS EndDate, ",
        "ISHUSERPRICE1 AS UserDefPrice, ISHUSER2 AS UserPriceTxt, ZZCLASS AS HospKerenInd, ZZRC1 AS RC1, ZZREFNUM AS AvivRefNum, ZZREFNUM2 AS AvivRefNum2, ZZOUT_OF_CAP AS OutCappFlg, ZZACCOUNT AS AvivAccount ",
        "FROM  SAPR3.VBRP WHERE erdat between '$start' AND '$end'"]],
    "sttappend":{
      "CreationDate": {"s":"ERDAT","t":"varchar(10)","f":"fDCast()"},
      "PricingDate":  {"s":"PRSDT","t":"varchar(10)","f":"fDCast()"},
      "SrvExecDate":  {"s":"FBUDA","t":"varchar(10)","f":"fDCast()"},
      "SrvBgDate":    {"s":"ISHBEGDT","t":"varchar(10)","f":"fDCast()"},
      "SrvEndDate":   {"s":"ISHENDDT","t":"varchar(10)","f":"fDCast()"},
      "IntBilDate":   {"s":"ISHDATZW","t":"varchar(10)","f":"fDCast()"},
      "StartDate":    {"s":"ISHUSERDATE1","t":"varchar(10)","f":"fDCast()"},
      "EndDate":      {"s":"ISHUSERDATE2","t":"varchar(10)","f":"fDCast()"},
      "SrvBgTime":    {"s":"ISHBEGZT","t":"varchar(10)","f":"fTCast()"},
      "SrvEndTime":   {"s":"ISHENDZT","t":"varchar(10)","f":"fTCast()"},
      "RC1":         {"s":"ZZRC1","f":"fNull('-1')"},
      "AvivRefNum":  {"s":"ZZREFNUM","f":"fNull('-1')"},
      "AvivRefNum2": {"s":"ZZREFNUM2","f":"fNull('-1')"},
      "AvivAccount": {"s":"ZZACCOUNT","f":"fNull('-1')"},
      "ETL_Date": {"t":"date","f":"fDCurr()"},
      "Quantity":{"t":"int"},
      "MvSqNum":{"t":"int"},
      "MultFactor":{"t":"int"},
      "BillitemNum":{"t":"int"},
      "PriceAfterGroupDisc":{"t":"decimal(15,2)"},
      "PriceSikum1":{"t":"decimal(15,2)"},
      "PriceAfter4Perc":{"t":"decimal(15,2)"},
      "PriceSikum3":{"t":"decimal(15,2)"},
      "UserDefPrice":{"t":"decimal(15,2)"}
    }
  },
  {"target": ["sql", "STG_NLEI"],
  "query": ["oracle", [
    "SELECT FALNR AS CaseNum, LEIST AS ServCode, LNRLS AS ServSqNum, LFDBEW AS MvSqNum, ANFOE AS OrgMedServMazm, ERBOE AS OrgNursServExec, HAUST AS CatKey,STALS AS StatusPlanned,",
    "IMENG AS ServQty, IBGDT AS ServBgDate, IENDT AS ServEndDate, IBZT AS ServBgTime, IEZT AS ServEndTime, ERDAT AS CreationDate, ERUSR AS CreationUser,",
    "UPDAT AS UpdateDate, UPUSR AS UpdateUser, STORN AS CancelFlg, STUSR AS CancelUser, ANPOE AS OrgNursServMazm, ABRKZ AS BillingFlg ",
    "FROM  SAPR3.NLEI WHERE einri='0001' /*AND length(FALNR)>0 AND STALS!='P'*/ AND STORN!='X' AND (erdat between '$start' AND '$end' OR updat  between '$start' AND '$end')"]
  ],
  "sttappend":{
    "ServBgDate":        {"s":"IBGDT","t":"varchar(10)","f":"fDCast()"},
    "ServEndDate":       {"s":"IENDT","t":"varchar(10)","f":"fDCast()"},
    "CreationDate":      {"s":"ERDAT","t":"varchar(10)","f":"fDCast()"},
    "UpdateDate":        {"s":"UPDAT","t":"varchar(10)","f":"fDCast()"},
    "ServBgTime":        {"s":"IBZT","t":"varchar(10)","f":"fTCast()"},
    "ServEndTime":       {"s":"IEZT","t":"varchar(10)","f":"fTCast()"},
    "ETL_Date": {"t":"date","f":"fDCurr()"},
    "OrgMed":{"t":"nvarchar(20)"},
    "OrgNurs":{"t":"nvarchar(20)"},
    "RoomCode":{"t":"varchar(10)"},
    "MvBgDate":{"t":"datetime"},
    "MvBgTime":{"t":"datetime"},
    "MvCat":{"t":"varchar(10)"},
    "MvType":{"t":"varchar(10)"},
    "MvReasFirstSec":{"t":"varchar(10)"},
    "MedOrgtree":{"t":"int"},
    "NursOrgTree":{"t":"int"},
    "MedServMazmOrgtree":  {"t":"int", "f":"fNull('-1')" },
    "NursServExecOrgtree": {"t":"int", "f":"fNull('-1')" },
    "NursServMazmOrgtree": {"t":"int", "f":"fNull('-1')" },
    "longdesc":{"t":"varchar(120)"},
    "PriceAfterGroupDisc":{"t":"numeric(15,2)"},
    "ServQty":{"t":"int"},
    "HospKerenInd":{"t":"varchar(10)"},
    "InsurProv":{"t":"varchar(20)"},
    "PlannedFlg":{"t":"varchar(1)"},
    "InsurProv_act":{"t":"varchar(20)"},
    "HospKerenInd_act":{"t":"varchar(50)"}
  }
 }
]